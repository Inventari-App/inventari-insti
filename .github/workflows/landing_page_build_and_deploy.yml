name: Build and Deploy Landing Page

on:
  push:
    branches: [master]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout Repository
        uses: actions/checkout@v2

      - name: Remove Existing Landing Page Directory
        run: |
          rm -rf ./parent-folder/landing-page

      - name: Clone Landing Page Repository
        run: |
          git clone git@github.com:Inventari-App/landing-page.git ./parent-folder/landing-page

      - name: Build and Deploy Landing Page
        env:
          DOCKER_BUILD_CONTEXT: ./parent-folder/landing-page
          DOCKERFILE_PATH: ./parent-folder/landing-page/Dockerfile
          APP_NAME: landing-page
          HOST: ${{ secrets.HOST }}
          SSHKEY: ${{ secrets.SSHKEY }}
          PASSPHRASE: ${{ secrets.PASSPHRASE }}
          USERNAME: ${{ secrets.USERNAME }}
        run: |
          docker-compose -f ./parent-folder/docker-compose.yml build $APP_NAME
          docker-compose -f ./parent-folder/docker-compose.yml up -d $APP_NAME
