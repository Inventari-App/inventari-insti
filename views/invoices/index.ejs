<% layout('layouts/boilerplate')%>
<h1>Tots els Invoices</h1>
<div>
  <a class="btn btn-primary mb-3" href="/invoices/new">Afegeix Invoice</a>
</div>

<table id="invoices-table" class="table table-striped align-middle">
  <thead>
    <tr>
      <th scope="col">Num. Comanda</th>
      <th scope="col">Responsable</th>
      <th scope="col">Num. Items</th>
      <th scope="col">Items</th>
      <th scope="col">Preu total</th>
      <th scope="col"></th>
    </tr>
  </thead>
  <tbody>
    <% for (let invoice of invoices) { %>
      <tr>
        <th scope="row"><%= invoice.numInvoice %></th>
        <td><%= invoice.responsable.username %></td>
        <td><%= invoice.invoiceItems.reduce((acc, item) => acc += item.quantitat, 0) %></td>
        <td>
          <span class="truncate">
            <%= 
              invoice.invoiceItems.reduce((acc, item) => {
                if (!acc.includes(item.article)) acc.push(item.article)
                return acc
              }, []).join(', ')
            %>
          </span>
        </td>
        <td><%= invoice.total.toFixed(2) %> â‚¬</td>
        <td>
          <a href="/invoices/<%= invoice._id %>" class="btn btn-primary">Veure</a>
        </td>
      </tr>
    <% } %>
  </tbody>
</table>


